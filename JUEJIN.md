# ðŸ–ä»Žä¸€ä¸ªè®°äº‹æœ¬å…¥é—¨nodeè„šæ‰‹æž¶å¼€å‘ 

> ä»€ä¹ˆæ˜¯è„šæ‰‹æž¶ï¼ŒæŒ‰ç…§ä¸ªäººç†è§£ï¼Œè„šæ‰‹æž¶å°±æ˜¯ä¸€ä¸ªé¡¹ç›®æ¨¡æ¿ï¼ˆå…¶å®žè¿˜å¯ä»¥åšæ›´å¤šçš„äº‹ï¼‰ï¼Œåœ¨è„šæ‰‹æž¶çš„å¸®åŠ©ä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥ä¸“æ³¨è‡ªå·±çš„ä¸šåŠ¡ä»£ç å¼€å‘ï¼Œè€Œä¸ç”¨å†èŠ±æ—¶é—´åŽ»é…ç½®é¡¹ç›®åˆå§‹æ¨¡æ¿ï¼Œè€Œä½¿ç”¨`NodeJS`è¿›è¡Œå¼€å‘çš„è„šæ‰‹æž¶ï¼Œæˆ‘ç§°ä¹‹ä¸º`NodeJS`è„šæ‰‹æž¶å¼€å‘ã€‚ 

## å‰è¨€

å°çŒªé…æ·‡æ‰‹ä¸Šçº¹ï¼Œæˆ‘ä»¬éƒ½æ˜¯æ‰“å·¥äººðŸ¤£ã€‚

ä½¿ç”¨ä¸‰å¤§é‡‘åˆšåšå‰ç«¯å¼€å‘çš„å°ä¼™ä¼´æƒ³å¿…éƒ½ä½¿ç”¨è¿‡å„å®¶çš„è„šæ‰‹æž¶å·¥å…·å§ï¼Œä¸çŸ¥é“æœ‰æ²¡æœ‰æ‰‹ç—’ç—’çš„æƒ³è¯•ç€å†™ä¸€ä¸‹çš„ï¼Œå•¦å•¦å•¦ï¼Œåæ­£æˆ‘çœ‹ç€ä½œè€…çš„æ–‡ç« æ˜¯æ‰‹ç—’å•¦ã€‚ä¹‹å‰ä¸€ç›´æƒ³ç€å­¦ä¹ `NodeJS`è„šæ‰‹æž¶å¼€å‘ï¼Œå¯æ˜¯æ¯æ¬¡éƒ½è¢«è‡ªå·±çš„æ‡’ç™Œæ‰“è´¥äº†ï¼Œè¿™æ¬¡ç»ˆäºŽæœ‰æ—¶(hua)é—´(shui)ï¼ŒäºŽæ˜¯èŠ±äº†ç‚¹æ—¶é—´å†™äº†ä¸ªå°`DEMO`ï¼Œä¹Ÿå°±æ˜¯æ–‡ç« é‡Œé¢çš„è®°äº‹æœ¬å·¥å…·ï¼Œè¿™ä¸ªå·¥å…·å¹¶æ²¡æœ‰æ¶‰åŠåˆ°`git`ä¸‹è½½ï¼ˆå¯ä»¥å‚è€ƒæŽ˜é‡‘å…¶ä»–æ–‡ç« ï¼‰ï¼Œå®ƒæ›´å¤šçš„æ˜¯å±•ç¤ºä¸€ä¸ªè„šæ‰‹æž¶è¯¥å…·å¤‡çš„å·¥ä½œæµç¨‹ä»¥åŠå¸¸ç”¨çš„ä¸€ä¸ªå·¥å…·ä½¿ç”¨ã€‚é‚£ä¹ˆï¼Œæˆ‘ä»¬å¼€å§‹å§ï¼

ä»£ç æ³¨é‡Šå†™çš„æ¯”è¾ƒæ¸…æ¥šï¼ŒæœŸæœ›æ¯ä¸€ä½å°ä¼™ä¼´éƒ½èƒ½çœ‹æ‡‚ã€‚å½“ç„¶ï¼Œä½œè€…æœ¬èº«ä¹Ÿåªæ˜¯ä¸€ååˆçº§å‰ç«¯ï¼Œå…¶ä¸­è¦æ˜¯æœ‰å•¥è®²çš„ä¸å¯¹çš„ï¼Œä¹Ÿè¯·å¤§ä½¬ä»¬æŒ‡å‡ºï¼Œæ‹œè°¢ðŸ™ˆã€‚



## åˆå§‹åŒ–çŽ¯å¢ƒ

### éœ€æ±‚

```
å®žçŽ°ä¸€ä¸ªnodejsè®°äº‹æœ¬ï¼Œè®°äº‹æœ¬ä»¥txtæ–‡ä»¶å½¢å¼å­˜å‚¨åœ¨æœ¬åœ°ï¼Œèƒ½å¤Ÿå®žçŽ°å¯¹å…¶çš„å¢žåˆ æŸ¥ã€‚
```

### é¡¹ç›®ç‰ˆæœ¬

> - **NodeJS:** v12.18.3
> 

### ç”¨åˆ°çš„å·¥å…·åº“
> - **chalk:** ä¿®æ”¹ç»ˆç«¯é¢œè‰²
> - **commander:**æ·»åŠ ç‰ˆæœ¬å‘½ä»¤æç¤º
> - **inquirer:** å‘½ä»¤è¡Œäº¤äº’
> - **minimis":** å‘½ä»¤è¡Œè§£æž
> - **ora:** ç»ˆç«¯æ—‹è½¬å™¨
> - **prettier:** ä»£ç æ ¼å¼åŒ–
> - **dayjs:** æ—¶é—´æ ¼å¼åŒ–å·¥å…·

### é¡¹ç›®ç»“æž„

éœ€è¦å…³æ³¨çš„æ–‡ä»¶

```
notepad-cli
â”œâ”€â”€ bin
â”‚   â””â”€â”€ notepad-cli.js -- å¯æ‰§è¡Œçš„æ–‡ä»¶
â”œâ”€â”€ doc
â”‚   â””â”€â”€ 1610262571511.txt --
â”œâ”€â”€ lib
â”‚   â”œâ”€â”€ commands --å…·ä½“å‘½ä»¤ç›®å½•
â”‚   â”‚   â”œâ”€â”€ add.js
â”‚   â”‚   â”œâ”€â”€ del.js
â”‚   â”‚   â”œâ”€â”€ exit.js
â”‚   â”‚   â”œâ”€â”€ find.js
â”‚   â”‚   â”œâ”€â”€ list.js
â”‚   â”‚   â””â”€â”€ open.js
â”‚   â”œâ”€â”€ config  --é…ç½®æ–‡ä»¶ç›®å½•
â”‚   â”‚   â””â”€â”€ index.js
â”‚   â”œâ”€â”€ service.js --å…¥å£æ–‡ä»¶
â”‚   â””â”€â”€ utils   --å·¥å…·ç±»å°è£…
â”‚       â”œâ”€â”€ file.js
â”‚       â””â”€â”€ utils.js
â”œâ”€â”€ package.json
```

### ä¸‹è½½æ¡ˆä¾‹

```bash
git clone https://github.com/taosiqi/notepad-cli.git
cd notepad-cli
yarn 
npm link é“¾æŽ¥åˆ°å…¨å±€åº“
notepad-cli open 
```

## æ¡ˆä¾‹åˆ†æž

### åˆ›å»ºé¡¹ç›®

```
1ã€mkdir notepad-cli && cd notepad-cli
2ã€ä¾æ®ä¸Šæ–‡ç›®å½•ç»“æž„åˆ›å»ºç›®å½•
3ã€å®‰è£…ä¸Šæ–‡æåˆ°çš„å·¥å…·åº“
```

`npm init` åˆ›å»º `package.json`ï¼Œæ·»åŠ  `bin` å‘½ä»¤

```json
"bin": {
    "notepad-cli": "bin/notepad-cli.js"  //æ‰§è¡Œnpm linkä¹‹åŽ å¯ä»¥ä½¿ç”¨notepad-cliä½¿ç”¨è„šæ‰‹æž¶
 },
```

### å…¥å£æ–‡ä»¶notepad-cli

æ‰§è¡Œ`notepad-cli`å°†ä¼šæ‰§è¡Œ`/bin/notepad-cli.js`æ–‡ä»¶

```javascript
#!/usr/bin/env node
// ç¬¬ä¸€è¡Œä¸å¯å°‘ï¼Œå…¶ä½œç”¨æ˜¯å®ƒå‘Šè¯‰ç³»ç»Ÿè¿™ä¸ªè„šæœ¬éœ€è¦ç”¨nodeè§£é‡Šå™¨æ¥æ‰§è¡Œã€‚
// è¿™ä¸ªæ–‡ä»¶ä¸»è¦æ˜¯ç”¨æ¥å¤„ç†æŽ¥å—å‚æ•°çš„å…¥å£æ–‡ä»¶ï¼Œ
const Service = require('../lib/service') //å¼•å…¥æˆ‘ä»¬çš„å…¥å£æ–‡ä»¶
const service = new Service() //å®žä¾‹åŒ–Service

const rawArgv = process.argv.slice(2)
console.log(rawArgv) //[ 'open' ]

const args = require('minimist')(rawArgv) //è§£æžå‘½ä»¤è¡Œå‚æ•°
console.log(args) //{ _: [ 'open' ] }

const command = args._[0]
// æ‰§è¡Œåˆå§‹åŒ–
service.run(command, args, rawArgv)
```

### å‘½ä»¤å…¥å£service

æ‰§è¡Œ`service.run(command, args, rawArgv)`å°†ä¼šæ‰§è¡Œ`/lib/service.js`æ–‡ä»¶

```javascript
const program = require('commander') //æ·»åŠ ç‰ˆæœ¬å‘½ä»¤æç¤º

const { packageInfo, open } = require('./config')  //é…ç½®æ–‡ä»¶
const {readDoc}=require('./utils/file') //æ–‡ä»¶æ“ä½œ


module.exports = class Service {
    constructor() {
        readDoc() //è¯»å–docä¸‹é¢çš„æ–‡ä»¶å­˜åˆ°ä¸€ä¸ªæ•°ç»„
        setupDefaultCommands() //è®¾ç½®é»˜è®¤å‘½ä»¤
        registerCommands() //æ³¨å†Œè‡ªå®šä¹‰å‘½ä»¤
    }
    run(_id, _args = {}, rawArgv = []) {
        program.parse(rawArgv, { from: 'user' })  //æ‰§è¡Œç›¸åº”çš„å‘½ä»¤
    }
}

// è®¾ç½®é»˜è®¤å‘½ä»¤
const setupDefaultCommands = () => {
    program.version(packageInfo.version, '-v, --version', 'è¾“å‡ºå½“å‰ç‰ˆæœ¬å·')
    program.helpOption('-h, --help', 'èŽ·å–å¸®åŠ©')
    program.addHelpCommand(false)
}
// æ³¨å†Œå‘½ä»¤
const registerCommands = () => {
    return program.command('open').description('æ‰“å¼€è®°äº‹æœ¬').alias('o').action(() => {
        open.apply(program.args)
    })
}

```

### æ‰“å¼€è®°äº‹æœ¬å‘½ä»¤ open

`/lib/service.js`æ–‡ä»¶æ³¨å†Œçš„è‡ªå®šä¹‰å‘½ä»¤ `open` ï¼Œä½¿ç”¨ `notepad-cli open`æ‰§è¡Œã€‚

```javascript
const inquirer = require('inquirer') ////å‘½ä»¤è¡Œäº¤äº’
const { readKey } = require('../utils/file')//æ–‡ä»¶æ“ä½œ
async function init(commands) {
    const promptList = {
        type: 'list',
        message: 'æ¬¢è¿Žä½¿ç”¨æ€æ·‡è®°äº‹æœ¬ï¼Œè¯·é€‰æ‹©éœ€è¦æ“ä½œçš„åŠŸèƒ½:',
        name: 'tools',
        choices: () => {
            let promptList = []
            // è¯»å–commandsä¸‹æ‰€æœ‰å‘½ä»¤ï¼Œä¾›ç”¨æˆ·é€‰æ‹©
            for (const commandsKey in commands) {
                promptList.push({
                    name: commands[commandsKey].description,
                    value: commandsKey
                })
            }
            return promptList
        }
    }
    return promptList
}

module.exports = {
    description: 'æ‰“å¼€è®°äº‹æœ¬',
    apply: async () => {
        let commands = await readKey()
        let promptList = await init(commands)
        await inquirer.prompt(promptList).then(async (answers) => {
            await commands[answers.tools].apply() //æ‰§è¡Œé€‰ä¸­çš„å‘½ä»¤
            const command = require(`${__dirname}/open.js`)
            await command.apply() //æ‰§è¡Œå®Œä¸Šè¿°åŠŸèƒ½åŽå›žåˆ°å½“å‰åŠŸèƒ½é¡µ
        })
    }
}
```

### å¢žåŠ è®°äº‹æœ¬ add

```javascript
const inquirer = require('inquirer') //å‘½ä»¤è¡Œäº¤äº’
const { succeed } = require('../utils/utils') //å°è£…çš„æç¤ºç±»åž‹log
const { add } = require('../utils/file') //æ–‡ä»¶æ“ä½œ
const dayjs = require('dayjs')
const promptList = [
    {
        type: 'input',
        message: 'è¯·è¾“å…¥æ ‡é¢˜:',
        name: 'title',
        validate: (val) => {
            return val !== ''
        }
    },
    {
        type: 'input',
        message: 'è¯·è¾“å…¥å†…å®¹:',
        name: 'content',
        validate: (val) => {
            return val !== ''
        }
    }
]

module.exports = {
    description: 'æ·»åŠ è®°äº‹',
    apply: async () => {
        await inquirer.prompt(promptList).then(async (answers) => {
            // æž„é€ æ–‡ä»¶ç»“æž„
            const timestamp = new Date().getTime()
            const data = {
                ...answers,
                time: dayjs().format('YYYY-MM-DD HH:mm:ss'),
                timestamp: timestamp
            }
            // åˆ›å»ºè®°äº‹æœ¬æ–‡ä»¶
            add(data, timestamp)
        })
        succeed('æ·»åŠ æˆåŠŸ')
        return Promise.resolve()
    }
}
```

### åˆ é™¤è®°äº‹æœ¬ del

```javascript
const { del } = require('../utils/file')
const { succeed, info } = require('../utils/utils')
const inquirer = require('inquirer')
function init() {
    const promptList = {
        type: 'input',
        message: 'è¯·è¾“å…¥éœ€è¦åˆ é™¤çš„è®°äº‹åºåˆ—å·:',
        name: 'del',
        validate: (val) => {
            let value = parseInt(val)
            return (
                typeof value === 'number' &&
                !isNaN(value) &&
                value > 0 &&
                value < articleList.length + 1
            )
        }
    }
    return promptList
}
function initLog() {
    let log = ''
    articleList.forEach((item, index) => {
        log += `${index + 1}:${item.title} \n`
    })
    return log
}
module.exports = {
    description: 'åˆ é™¤è®°äº‹',
    apply: async () => {
        let promptList = await init()
        let log = await initLog() //æ˜¾ç¤ºæ‰€æœ‰æ–‡ç« åˆ—è¡¨
        info(log)
        await inquirer.prompt(promptList).then(async (answers) => {
            await del(answers['del'])
            succeed('åˆ é™¤æˆåŠŸ')
            return Promise.resolve()
        })
    }
}
```

### é€€å‡ºè®°äº‹æœ¬ exit

```javascript
const { succeed } = require('../utils/utils')
module.exports = {
    description: 'é€€å‡ºè®°äº‹',
    apply: async (env) => {
        succeed('é€€å‡ºæˆåŠŸ')
        process.exit(1)
    }
}
```

### æŸ¥æ‰¾è®°äº‹æœ¬ find

```javascript
const inquirer = require('inquirer')
const { info, underline } = require('../utils/utils')
// è¾“å…¥æŸ¥æ‰¾çš„å…³é”®è¯
function init() {
    const promptList = {
        type: 'input',
        message: 'è¯·è¾“å…¥è®°äº‹æ–‡ç« å…³é”®è¯:',
        name: 'find',
        validate: (val) => {
            return val != ''
        }
    }
    return promptList
}
// æ ¹æ®å…³é”®è¯ç­›é€‰
function filtrate(keyWord) {
    const filtrateData = {
        type: 'list',
        message: 'è®°äº‹åˆ—è¡¨:',
        name: 'tools',
        choices: () => {
            let promptList = []
            const data = articleList.filter((item, index) => {
                return (
                    item.title.indexOf(keyWord) != -1 ||
                    item.content.indexOf(keyWord) != -1
                )
            })
            data.forEach((item, index) => {
                promptList.push({
                    name: item.title + '  ' + item.time,
                    value: index
                })
            })
            return promptList
        }
    }
    return filtrateData
}
module.exports = {
    description: 'æŸ¥æ‰¾è®°äº‹',
    apply: async () => {
        let promptList = await init()
        let keyWord = ''
        await inquirer.prompt(promptList).then((answers) => {
            keyWord = answers.find
        })
        let filtrateData = await filtrate(keyWord)
        if (filtrateData.choices().length !== 0) {
            await inquirer.prompt(filtrateData).then((answers) => {
                console.log(underline(articleList[answers.tools].content))
            })
        } else {
            info('æœªæœç´¢åˆ°å†…å®¹')
        }
    }
}
```

### è®°äº‹æœ¬åˆ—è¡¨ list

```javascript
const inquirer = require('inquirer')
const { info, underline } = require('../utils/utils')
function init() {
    const promptList = {
        type: 'list',
        message: 'è®°äº‹åˆ—è¡¨:',
        name: 'tools',
        choices: () => {
            let promptList = []
            articleList.forEach((item, index) => {
                promptList.push({
                    name: item.title + '  ' + item.time,
                    value: index
                })
            })
            return promptList
        }
    }
    return promptList
}
module.exports = {
    description: 'è®°äº‹åˆ—è¡¨',
    apply: async () => {
        let promptList = await init()
        if (promptList.choices().length !== 0) {
            await inquirer.prompt(promptList).then((answers) => {
                console.log(underline(articleList[answers.tools].content))
            })
        } else {
            info('æœªæœç´¢åˆ°å†…å®¹')
        }
    }
}
```

### é…ç½®æ–‡ä»¶ config/index

```javascript
module.exports = {
    packageInfo: require('../../package.json'),
    open: require('../commands/open')
}
```

### æ–‡ä»¶æ“ä½œ file

```javascript
const fs = require('fs')
const path = require('path')
const docPath = path.join(__dirname, `../../doc`)
const commandPath = path.join(__dirname, `../commands`)
module.exports = {
    // å¢žåŠ æ–‡ä»¶
    add: (data, timestamp) => {
        fs.writeFile(
            `${docPath}/${timestamp}.txt`,
            JSON.stringify(data),
            (error) => {
                if (error) {
                    console.error('å†™å…¥å¤±è´¥äº†')
                } else {
                    articleList.push(data)
                }
            }
        )
    },
    // åˆ é™¤æ–‡ä»¶
    del: (name) => {
        fs.unlinkSync(`${docPath}/${articleList[name - 1].timestamp}.txt`)
        articleList.splice(name - 1, 1)
    },
    //è¯»å–commandsç›®å½•ä¸‹å‘½ä»¤
    readKey: () => {
        let commands = {}
        fs.readdirSync(commandPath).forEach((paths) => {
            const command = require(`${commandPath}/${paths}`)
            if (Object.keys(command).length !== 0) {
                let commandName = paths.slice(0, -3)
                commands[commandName] = command
            }
        })
        return commands
    },
    // è¯»å–docç›®å½•ä¸‹æ–‡ä»¶å†…å®¹
    readDoc: () => {
        global.articleList = []
        fs.readdirSync(docPath).forEach((fileName) => {
            fs.readFile(
                `${docPath}/${fileName}`,
                'utf-8',
                function (err, data) {
                    if (err) {
                        console.error(err)
                    } else {
                        articleList.push(JSON.parse(data))
                    }
                }
            )
        })
        articleList.reverse()
    }
}
```

### æ–‡æœ¬æç¤ºutil

```javascript
const ora = require('ora')
const chalk = require('chalk')

module.exports = {
  // æ—¥å¿—ä¿¡æ¯
  log: (message) => {
    console.log(message)
  },
  // æˆåŠŸä¿¡æ¯
  succeed: (...message) => {
    ora().succeed(chalk.greenBright.bold(message))
  },
  // æç¤ºä¿¡æ¯
  info: (...message) => {
    ora().info(chalk.blueBright.bold(message))
  },
  // é”™è¯¯ä¿¡æ¯
  error: (...message) => {
    ora().fail(chalk.redBright.bold(message))
  },
  // ä¸‹åˆ’çº¿é‡ç‚¹ä¿¡æ¯
  underline: (message) => {
    return chalk.underline.blueBright.bold(message)
  }
}
```

## æ€»ç»“

å°è€Œç¾Žçš„mittåº“ï¼Œé‡Œé¢çš„è®¾è®¡æ¨¡å¼ã€ä»¥åŠä¸€äº›å°çš„æŠ€å·§ã€è¿ç®—ç¬¦çš„è¿ç”¨ï¼Œéƒ½å€¼å¾—æˆ‘ä»¬åŽ»å­¦ä¹ ï¼Œåœ¨ä½¿ç”¨ä¸­ä¹Ÿé‡åˆ°çš„ä¸€äº›å°å‘ï¼Œéƒ½èƒ½å¤Ÿè®©æˆ‘ä»¬çš„åŸºç¡€æ›´åŠ ç¨³å›ºã€‚
**å¸Œæœ›çœ‹å®Œçš„æœ‹å‹å¯ä»¥åŠ¨åŠ¨æ‰‹ç‚¹ä¸ªèµžå†èµ°å“¦ï¼Œä½ ä»¬çš„æ”¯æŒæ˜¯å¯¹æˆ‘æœ€å¤§çš„é¼“åŠ±å•Šï¼ï¼ï¼**

## å¼•ç”¨

> 1. [deploy-cli-service](https://github.com/fuchengwei/deploy-cli-service)
